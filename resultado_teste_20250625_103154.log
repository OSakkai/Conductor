üî• INICIANDO TESTE DE ESTRESSE - SISTEMA DE CHAVES COMPLETO
============================================================

üìã FASE 1: PREPARA√á√ÉO DO AMBIENTE
=================================
1.1 - Verificando conectividade...
üîê Obtendo token de administrador...
‚úÖ Token obtido: eyJhbGciOiJIUzI1NiIs...
1.2 - Limpando chaves de teste anteriores...
1.3 - Estado inicial das chaves...
mysql: [Warning] Using a password on the command line interface can be insecure.
+--------------+
| total_chaves |
+--------------+
|            5 |
+--------------+

üìã FASE 2: CRIA√á√ÉO DE CHAVES DOS 3 TIPOS
=======================================
2.1 - Criando chave PERMANENTE...
‚úÖ TESTE 1: Cria√ß√£o de chave permanente
2.2 - Criando chave DE USO √öNICO...
‚úÖ TESTE 2: Cria√ß√£o de chave de uso √∫nico
2.3 - Criando chave EXPIR√ÅVEL (30 segundos)...
‚úÖ TESTE 3: Cria√ß√£o de chave expir√°vel
2.4 - Criando chave EXPIR√ÅVEL j√° expirada...
‚ùå TESTE 4: Cria√ß√£o de chave j√° expirada - Resposta: {"success":false,"message":"Erro ao criar chave","error":"Data de expira√ß√£o deve ser no futuro"}
2.5 - Verificando chaves criadas no banco...
mysql: [Warning] Using a password on the command line interface can be insecure.
+------------------------+------------+---------------+----------+---------------------+
| chave                  | tipo       | permissao     | status   | data_expiracao      |
+------------------------+------------+---------------+----------+---------------------+
| TEST-EXPIRE-1750858314 | expiring   | Administrador | ativa    | 2025-06-25 13:32:25 |
| TEST-SINGLE-1750858314 | single_use | Operador      | ativa    | NULL                |
| TEST-PERM-1750858314   | permanent  | Usuario       | ativa    | NULL                |
| TEST-EXPIRE-1750856562 | expiring   | Administrador | expirada | 2025-06-25 13:03:13 |
| TEST-SINGLE-1750856562 | single_use | Operador      | usada    | NULL                |
| TEST-PERM-1750856562   | permanent  | Usuario       | ativa    | NULL                |
+------------------------+------------+---------------+----------+---------------------+

üìã FASE 3: TESTE DE ESTRESSE - CHAVE PERMANENTE
===============================================
3.1 - Validando chave permanente (deve funcionar sempre)...
‚úÖ TESTE 5: Valida√ß√£o 1 da chave permanente
‚úÖ TESTE 6: Valida√ß√£o 2 da chave permanente
‚úÖ TESTE 7: Valida√ß√£o 3 da chave permanente
‚úÖ TESTE 8: Valida√ß√£o 4 da chave permanente
‚úÖ TESTE 9: Valida√ß√£o 5 da chave permanente
3.2 - Registrando m√∫ltiplos usu√°rios com chave permanente...
‚úÖ TESTE 10: Registro 1 com chave permanente
‚úÖ TESTE 11: Registro 2 com chave permanente
‚úÖ TESTE 12: Registro 3 com chave permanente
3.3 - Verificando se chave permanente ainda est√° ativa...
mysql: [Warning] Using a password on the command line interface can be insecure.
+----------------------+------------+--------+
| chave                | usos_atual | status |
+----------------------+------------+--------+
| TEST-PERM-1750858314 |          0 | ativa  |
+----------------------+------------+--------+
3.4 - Verificando usu√°rios criados com chave permanente...
mysql: [Warning] Using a password on the command line interface can be insecure.
+------------------------+-----------+
| nome_usuario           | permissao |
+------------------------+-----------+
| perm_user_1_1750856562 | Usuario   |
| perm_user_1_1750858314 | Usuario   |
| perm_user_2_1750856562 | Usuario   |
| perm_user_2_1750858314 | Usuario   |
| perm_user_3_1750856562 | Usuario   |
| perm_user_3_1750858314 | Usuario   |
+------------------------+-----------+

üìã FASE 4: TESTE DE ESTRESSE - CHAVE DE USO √öNICO
================================================
4.1 - Primeira valida√ß√£o da chave de uso √∫nico (deve funcionar)...
‚úÖ TESTE 13: Primeira valida√ß√£o de chave single_use
4.2 - Primeiro registro com chave de uso √∫nico (deve funcionar)...
‚ùå TESTE 14: Primeiro registro com chave single_use - Resposta: {"message":"Chave de acesso inv√°lida: Chave inativa ou expirada","error":"Bad Request","statusCode":400}
4.3 - Verificando se chave foi marcada como usada...
mysql: [Warning] Using a password on the command line interface can be insecure.
+------------------------+------------+-------------+--------+
| chave                  | usos_atual | usos_maximo | status |
+------------------------+------------+-------------+--------+
| TEST-SINGLE-1750858314 |          1 |           1 | usada  |
+------------------------+------------+-------------+--------+
4.4 - Segunda valida√ß√£o da chave (deve falhar - j√° usada)...
‚úÖ TESTE 15: Segunda valida√ß√£o de chave usada
‚úÖ TESTE 16: Chave single_use corretamente invalidada ap√≥s uso
4.5 - Tentativa de segundo registro (deve falhar)...
‚ùå TESTE 17: Segundo registro com chave j√° usada (deve falhar) - Resposta: {"message":"Chave de acesso inv√°lida: Chave inativa ou expirada","error":"Bad Request","statusCode":400}

üìã FASE 5: TESTE DE ESTRESSE - CHAVE EXPIR√ÅVEL
==============================================
5.1 - Validando chave expir√°vel ANTES da expira√ß√£o...
‚úÖ TESTE 18: Valida√ß√£o de chave antes da expira√ß√£o
‚úÖ TESTE 19: Chave expir√°vel v√°lida antes da expira√ß√£o
5.2 - Registrando usu√°rio com chave antes da expira√ß√£o...
‚úÖ TESTE 20: Registro com chave antes da expira√ß√£o
5.3 - Aguardando expira√ß√£o da chave (35 segundos)...
Tempo restante: 35s Tempo restante: 34s Tempo restante: 33s Tempo restante: 32s Tempo restante: 31s Tempo restante: 30s Tempo restante: 29s Tempo restante: 28s Tempo restante: 27s Tempo restante: 26s Tempo restante: 25s Tempo restante: 24s Tempo restante: 23s Tempo restante: 22s Tempo restante: 21s Tempo restante: 20s Tempo restante: 19s Tempo restante: 18s Tempo restante: 17s Tempo restante: 16s Tempo restante: 15s Tempo restante: 14s Tempo restante: 13s Tempo restante: 12s Tempo restante: 11s Tempo restante: 10s Tempo restante: 9s Tempo restante: 8s Tempo restante: 7s Tempo restante: 6s Tempo restante: 5s Tempo restante: 4s Tempo restante: 3s Tempo restante: 2s Tempo restante: 1s 
5.4 - Validando chave AP√ìS expira√ß√£o (deve falhar)...
‚úÖ TESTE 21: Valida√ß√£o ap√≥s expira√ß√£o
‚úÖ TESTE 22: Chave expir√°vel corretamente invalidada ap√≥s expira√ß√£o
5.5 - Tentativa de registro ap√≥s expira√ß√£o (deve falhar)...
‚ùå TESTE 23: Registro com chave expirada (deve falhar) - Resposta: {"message":"Chave de acesso inv√°lida: Chave inativa ou expirada","error":"Bad Request","statusCode":400}
5.6 - Verificando status das chaves no banco ap√≥s expira√ß√£o...
mysql: [Warning] Using a password on the command line interface can be insecure.
+------------------------+----------+----------+---------------------+--------------+
| chave                  | tipo     | status   | data_expiracao      | tempo_status |
+------------------------+----------+----------+---------------------+--------------+
| TEST-EXPIRE-1750858314 | expiring | expirada | 2025-06-25 13:32:25 | EXPIRADA     |
+------------------------+----------+----------+---------------------+--------------+

üìã FASE 6: TESTE DE CHAVE J√Å EXPIRADA
====================================
6.1 - Validando chave j√° expirada desde cria√ß√£o...
‚úÖ TESTE 24: Valida√ß√£o de chave j√° expirada
‚úÖ TESTE 25: Chave j√° expirada corretamente invalidada
6.2 - Tentativa de registro com chave j√° expirada (deve falhar)...
‚ùå TESTE 26: Registro com chave j√° expirada (deve falhar) - Resposta: {"message":"Chave de acesso inv√°lida: Chave n√£o encontrada","error":"Bad Request","statusCode":400}

üìã FASE 7: TESTES DE EDGE CASES
===============================
7.1 - Valida√ß√£o com chave vazia...
‚úÖ TESTE 27: Valida√ß√£o com chave vazia
7.2 - Valida√ß√£o com chave inexistente...
‚úÖ TESTE 28: Valida√ß√£o com chave inexistente
‚úÖ TESTE 29: Chave inexistente corretamente invalidada
7.3 - Registro sem chave (deve criar Visitante)...
‚úÖ TESTE 30: Registro sem chave
7.4 - M√∫ltiplas valida√ß√µes simult√¢neas da chave permanente...
‚úÖ TESTE 31: 10 valida√ß√µes simult√¢neas da chave permanente

üìã FASE 8: VERIFICA√á√ïES FINAIS
==============================
8.1 - Estado final de todas as chaves de teste...
mysql: [Warning] Using a password on the command line interface can be insecure.
+------------------------+------------+---------------+------------+-------------+----------+---------------+
| chave                  | tipo       | permissao     | usos_atual | usos_maximo | status   | tempo_status  |
+------------------------+------------+---------------+------------+-------------+----------+---------------+
| TEST-PERM-1750856562   | permanent  | Usuario       |          0 |        NULL | ativa    | SEM_EXPIRACAO |
| TEST-SINGLE-1750856562 | single_use | Operador      |          1 |           1 | usada    | SEM_EXPIRACAO |
| TEST-EXPIRE-1750856562 | expiring   | Administrador |          0 |        NULL | expirada | EXPIRADA      |
| TEST-PERM-1750858314   | permanent  | Usuario       |          0 |        NULL | ativa    | SEM_EXPIRACAO |
| TEST-SINGLE-1750858314 | single_use | Operador      |          1 |           1 | usada    | SEM_EXPIRACAO |
| TEST-EXPIRE-1750858314 | expiring   | Administrador |          0 |        NULL | expirada | EXPIRADA      |
+------------------------+------------+---------------+------------+-------------+----------+---------------+
8.2 - Usu√°rios criados durante os testes...
mysql: [Warning] Using a password on the command line interface can be insecure.
+------------------------+---------------+-------------+----------------------------+
| nome_usuario           | permissao     | funcao      | data_criacao               |
+------------------------+---------------+-------------+----------------------------+
| no_key_user_1750858314 | Visitante     | Estagiario  | 2025-06-25 13:32:35.695466 |
| expire_user_1750858314 | Administrador | Gestor      | 2025-06-25 13:31:58.380544 |
| perm_user_3_1750858314 | Usuario       | Analista    | 2025-06-25 13:31:56.809847 |
| perm_user_2_1750858314 | Usuario       | Analista    | 2025-06-25 13:31:56.614253 |
| perm_user_1_1750858314 | Usuario       | Analista    | 2025-06-25 13:31:56.406034 |
| no_key_user_1750856562 | Visitante     | Estagiario  | 2025-06-25 13:03:23.872386 |
| expire_user_1750856562 | Administrador | Gestor      | 2025-06-25 13:02:46.561049 |
| single_user_1750856562 | Operador      | Coordenador | 2025-06-25 13:02:45.790797 |
| perm_user_3_1750856562 | Usuario       | Analista    | 2025-06-25 13:02:44.898741 |
| perm_user_2_1750856562 | Usuario       | Analista    | 2025-06-25 13:02:44.668450 |
| perm_user_1_1750856562 | Usuario       | Analista    | 2025-06-25 13:02:44.480152 |
| docker_user teste      | Desenvolvedor | Diretor     | 2025-06-17 16:18:47.438140 |
+------------------------+---------------+-------------+----------------------------+
8.3 - Estat√≠sticas finais do sistema...
mysql: [Warning] Using a password on the command line interface can be insecure.
+--------------+---------------+---------------+------------------+----------------+------------------------------+
| total_chaves | chaves_ativas | chaves_usadas | chaves_expiradas | total_usuarios | usuarios_criados_ultima_hora |
+--------------+---------------+---------------+------------------+----------------+------------------------------+
|            8 |             3 |             3 |                2 |             45 |                           13 |
+--------------+---------------+---------------+------------------+----------------+------------------------------+
8.4 - Testando login dos usu√°rios criados...
8.4.1 - Login do usu√°rio com chave permanente...
‚úÖ TESTE 32: Login do usu√°rio com chave permanente
8.4.2 - Login do usu√°rio com chave de uso √∫nico...
‚ùå TESTE 33: Login do usu√°rio com chave single_use - Resposta: {"message":"Credenciais inv√°lidas","error":"Unauthorized","statusCode":401}
8.4.3 - Login do usu√°rio com chave expir√°vel...
‚úÖ TESTE 34: Login do usu√°rio com chave expir√°vel

=======================================================
üî• TESTE DE ESTRESSE CONCLU√çDO
=======================================================

üìä ESTAT√çSTICAS DOS TESTES:
  Total de testes executados: 34
  Sucessos: 28
  Falhas: 6
  Taxa de sucesso: 82%

‚ö†Ô∏è  ALGUNS TESTES FALHARAM (6/34)
‚ùó Verifique os logs acima para identificar problemas

=======================================================
üîß RESUMO T√âCNICO:
  - Chaves criadas: 4 (permanent, single_use, expiring, expired)
  - Usu√°rios criados: ~6-8 (dependendo dos testes)
  - Tipos de teste: Valida√ß√£o, Registro, Expira√ß√£o, Edge cases
  - Tempo total: ~45 segundos (incluindo espera de expira√ß√£o)
=======================================================
